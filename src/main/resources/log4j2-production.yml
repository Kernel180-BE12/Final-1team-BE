Configuration:
  name: production

  Properties:
    Property:
      - name: "log-path"
        value: "./logs"
      - name: "charset-UTF-8"
        value: "UTF-8"
      - name: "console-layout-pattern"
        value: "%highlight{[%-5level]} [%X{id}] %d{MM-dd HH:mm:ss} [%t] %msg%n"
      - name: "file-layout-pattern"
        value: "[%X{id}] %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"
      - name: "info-log"
        value: ${log-path}/base/info.log
      - name: "error-log"
        value: ${log-path}/base/error.log
      - name: "auth-log"
        value: ${log-path}/base/auth.log
      - name: "json-log"
        value: ${log-path}/base/json-info.log
      - name: "archive-path"
        value: ${log-path}/archive
      - name: "jdbc-driver"
        value: "${spring:spring.datasource.driver-class-name}"
      - name: "jdbc-url"
        value: "${spring:spring.datasource.url}"
      - name: "jdbc-user"
        value: "${spring:spring.datasource.username}"
      - name: "jdbc-pass"
        value: "${spring:spring.datasource.password}"
      - name: "db-table"
        value: "log_table"
      - name: "db-layout-pattern"
        value: "[%X{id}] %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"

  Appenders:
    Console:
      name: console-appender
      target: SYSTEM_OUT
      PatternLayout:
        pattern: ${console-layout-pattern}

    RollingFile:
      name: rolling-file-appender
      fileName: ${log-path}/rolling-file.log
      filePattern: "${archive-path}/rolling-file.%d{yyyy-MM-dd-HH}_%i.gz"
      PatternLayout:
        charset: ${charset-UTF-8}
        pattern: ${file-layout-pattern}
      Policies:
        SizeBasedTriggeringPolicy:
          size: "10MB"
        TimeBasedTriggeringPolicy:
          interval: "1"
      DefaultRolloverStrategy:
        max: "30"
        fileIndex: "max"

    File:
      - name: file-info-appender
        fileName: ${info-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-error-appender
        fileName: ${error-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-auth-appender
        fileName: ${auth-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-json-info-appender
        fileName: ${json-log}
        PatternLayout:
          pattern: ${file-layout-pattern}

    JDBC:
      name: db-appender
      tableName: ${db-table}
      bufferSize: 0
      DriverManager:
        driverClassName: ${jdbc-driver}
        connectionString: ${jdbc-url}
        userName: ${jdbc-user}
        password: ${jdbc-pass}
      Column:
        - name: created_at
          isEventTimestamp: true
        - name: contents
          pattern: ${db-layout-pattern}

    Async:
      name: async-db-appender
      AppenderRef:
        - ref: db-appender

  Loggers:
    Root:
      level: WARN
      AppenderRef:
        - ref: console-appender
        - ref: rolling-file-appender
        - ref: async-db-appender

    Logger:
      # 애플리케이션 핵심
      - name: org.fastcampus.jober
        additivity: "false"
        level: DEBUG
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender
          - ref: file-error-appender
          - ref: async-db-appender

      # Spring Security (감사/인증)
      - name: org.springframework.security
        additivity: "false"
        level: DEBUG
        AppenderRef:
          - ref: console-appender
          - ref: file-auth-appender
          - ref: async-db-appender

      # 웹 요청
      - name: org.springframework.web
        additivity: "false"
        level: DEBUG
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender
          - ref: async-db-appender

      # 트랜잭션
      - name: org.springframework.transaction
        additivity: "false"
        level: WARN
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender

      # Hibernate SQL/바인딩 (운영 OFF)
      - name: org.hibernate.SQL
        level: "OFF"
      - name: org.hibernate.orm.jdbc.bind
        level: "OFF"

      # HikariCP (운영 OFF)
      - name: com.zaxxer.hikari
        level: "OFF"
